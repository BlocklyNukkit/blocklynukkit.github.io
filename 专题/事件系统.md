# 事件系统

## 什么是事件  

事件是nukkit服务器发生的动作，当事件触发时，会调用bn中与事件名同名的函数，并且在调用的时候会向函数注入一个事件对象作为参数，这个函数我们称之为事件回调函数，又叫做事件的监听器。简单的说，事件就是nukkit服务器和你的插件沟通的桥梁。  

## 事件的工作方式  

这里我们以玩家聊天事件来举例子  

<svg height="1038.306640625" version="1.1" width="611.22265625" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative; left: -0.2px; top: -0.1px;" viewBox="0 0 611.22265625 1038.306640625" preserveAspectRatio="xMidYMid meet"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.2.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><marker id="raphael-marker-endblock33-objf7fvb" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj2mt97" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj42i5t" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objmgty3" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj4av7j" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objvaj97" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj0ia59" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objt2nvj" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objzoryq" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj1tlho" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="0" y="0" width="204.015625" height="36.015625" rx="20" ry="20" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" class="flowchart" id="st" transform="matrix(1,0,0,1,68.5938,41.998)"></rect><text x="10" y="18.0078125" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="stt" class="flowchartt" transform="matrix(1,0,0,1,68.5938,41.998)" stroke-width="1"><tspan dy="4.796875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">玩家在聊天框输入文字并发送</tspan></text><path fill="#ffffff" stroke="#000000" d="M10,18.0078125L0,36.015625L259.78125,36.015625L279.78125,0L20,0L10,18.0078125" stroke-width="3" id="serverget" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" transform="matrix(1,0,0,1,30.7109,170.0117)"></path><text x="30" y="18.0078125" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="servergett" class="flowchartt" transform="matrix(1,0,0,1,30.7109,170.0117)" stroke-width="1"><tspan dy="4.796875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">nukkit服务器收到发送聊天文字请求</tspan></text><path fill="#ffffff" stroke="#000000" d="M54.005859375,27.0029296875L0,54.005859375L108.01171875,108.01171875L216.0234375,54.005859375L108.01171875,0L0,54.005859375" stroke-width="3" id="hasFun" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" transform="matrix(1,0,0,1,62.5898,262.0273)"></path><text x="59.005859375" y="54.005859375" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="hasFunt" class="flowchartt" transform="matrix(1,0,0,1,62.5898,262.0273)" stroke-width="1"><tspan dy="-3.603515625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">bn查找是否</tspan><tspan dy="16.8" x="59.005859375" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">有与事件同名函数</tspan></text><rect x="0" y="0" width="147.203125" height="36.015625" rx="0" ry="0" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" class="flowchart" id="spawnEvent" transform="matrix(1,0,0,1,97,462.0371)"></rect><text x="10" y="18.0078125" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="spawnEventt" class="flowchartt" transform="matrix(1,0,0,1,97,462.0371)" stroke-width="1"><tspan dy="4.796875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">生成对应的事件对象</tspan></text><rect x="0" y="0" width="329.203125" height="36.015625" rx="0" ry="0" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" class="flowchart" id="callFun" transform="matrix(1,0,0,1,6,590.0508)"></rect><text x="10" y="18.0078125" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="callFunt" class="flowchartt" transform="matrix(1,0,0,1,6,590.0508)" stroke-width="1"><tspan dy="4.796875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">执行事件回调函数，并将事件对象作为第一个参数</tspan></text><rect x="0" y="0" width="218.015625" height="36.015625" rx="0" ry="0" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" class="flowchart" id="wait_end" transform="matrix(1,0,0,1,61.5938,718.0645)"></rect><text x="10" y="18.0078125" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="wait_endt" class="flowchartt" transform="matrix(1,0,0,1,61.5938,718.0645)" stroke-width="1"><tspan dy="4.796875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">等待所有事件回调函数执行完成</tspan></text><path fill="#ffffff" stroke="#000000" d="M43.20703125,21.603515625L0,43.20703125L86.4140625,86.4140625L172.828125,43.20703125L86.4140625,0L0,43.20703125" stroke-width="3" id="isCancelled" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" transform="matrix(1,0,0,1,84.1875,820.8789)"></path><text x="48.20703125" y="43.20703125" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="isCancelledt" class="flowchartt" transform="matrix(1,0,0,1,84.1875,820.8789)" stroke-width="1"><tspan dy="-3.60546875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">检测事件</tspan><tspan dy="16.8" x="48.20703125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">是否有被取消</tspan></text><rect x="0" y="0" width="161.21875" height="36.015625" rx="20" ry="20" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" class="flowchart" id="e2" transform="matrix(1,0,0,1,89.9922,999.291)"></rect><text x="10" y="18.0078125" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="e2t" class="flowchartt" transform="matrix(1,0,0,1,89.9922,999.291)" stroke-width="1"><tspan dy="4.796875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">不执行聊天请求并结束</tspan></text><rect x="0" y="0" width="162.015625" height="36.015625" rx="0" ry="0" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" class="flowchart" id="parseEvent" transform="matrix(1,0,0,1,396.6094,846.0781)"></rect><text x="10" y="18.0078125" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="parseEventt" class="flowchartt" transform="matrix(1,0,0,1,396.6094,846.0781)" stroke-width="1"><tspan dy="4.796875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">解析修改过的事件对象</tspan></text><rect x="0" y="0" width="246.015625" height="36.015625" rx="20" ry="20" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" class="flowchart" id="e3" transform="matrix(1,0,0,1,354.6094,974.0918)"></rect><text x="10" y="18.0078125" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="e3t" class="flowchartt" transform="matrix(1,0,0,1,354.6094,974.0918)" stroke-width="1"><tspan dy="4.796875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">根据解析结果来执行玩家的聊天请求</tspan></text><rect x="0" y="0" width="218.015625" height="36.015625" rx="20" ry="20" fill="#ffffff" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" class="flowchart" id="e" transform="matrix(1,0,0,1,390.207,298.0254)"></rect><text x="10" y="18.0078125" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="et" class="flowchartt" transform="matrix(1,0,0,1,390.207,298.0254)" stroke-width="1"><tspan dy="4.796875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">按默认方式执行玩家的聊天请求</tspan></text><path fill="none" stroke="#000000" d="M170.6015625,78.013671875C170.6015625,78.013671875,170.6015625,147.04177412204444,170.6015625,165.51218429361688" stroke-width="3" marker-end="url(#raphael-marker-endblock33-objf7fvb)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M170.6015625,206.02734375C170.6015625,206.02734375,170.6015625,244.22811460494995,170.6015625,257.52750406763516" stroke-width="3" marker-end="url(#raphael-marker-endblock33-obj2mt97)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M170.6015625,370.0390625C170.6015625,370.0390625,170.6015625,439.06716474704444,170.6015625,457.5375749186169" stroke-width="3" marker-end="url(#raphael-marker-endblock33-obj42i5t)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><text x="175.6015625" y="380.0390625" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" stroke-width="1"><tspan dy="4.796875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">yes</tspan></text><path fill="none" stroke="#000000" d="M278.61328125,316.033203125C278.61328125,316.033203125,364.8646942730993,316.033203125,385.711593416866,316.033203125" stroke-width="3" marker-end="url(#raphael-marker-endblock33-objmgty3)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><text x="283.61328125" y="306.033203125" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" stroke-width="1"><tspan dy="4.806640625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">no</tspan></text><path fill="none" stroke="#000000" d="M170.6015625,498.052734375C170.6015625,498.052734375,170.6015625,567.0808366220444,170.6015625,585.5512467936169" stroke-width="3" marker-end="url(#raphael-marker-endblock33-obj4av7j)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M170.6015625,626.06640625C170.6015625,626.06640625,170.6015625,695.0945084970444,170.6015625,713.5649186686169" stroke-width="3" marker-end="url(#raphael-marker-endblock33-objvaj97)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M170.6015625,754.080078125C170.6015625,754.080078125,170.6015625,801.3877433064627,170.6015625,816.3792836886741" stroke-width="3" marker-end="url(#raphael-marker-endblock33-obj0ia59)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M170.6015625,907.29296875C170.6015625,907.29296875,170.6015625,976.3210709970444,170.6015625,994.7914811686169" stroke-width="3" marker-end="url(#raphael-marker-endblock33-objt2nvj)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><text x="175.6015625" y="917.29296875" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" stroke-width="1"><tspan dy="4.80078125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">yes</tspan></text><path fill="none" stroke="#000000" d="M257.015625,864.0859375C257.015625,864.0859375,368.1685359533876,864.0859375,392.10331804833095,864.0859375" stroke-width="3" marker-end="url(#raphael-marker-endblock33-objzoryq)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><text x="262.015625" y="854.0859375" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" stroke-width="1"><tspan dy="4.796875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">no</tspan></text><path fill="none" stroke="#000000" d="M477.6171875,882.09375C477.6171875,882.09375,477.6171875,951.1218522470444,477.6171875,969.5922624186169" stroke-width="3" marker-end="url(#raphael-marker-endblock33-obj1tlho)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path></svg>

正如你看到的，玩家聊天事件的执行方式就是这样，其他的事件我们也用十分类似的方式进行。  

## 如何创建一个事件回调函数  

事件回调函数又称事件监听器，只要您创建一个与您希望处理的事件名称相同的函数，也就是说，一个bn插件对于每一个事件只能有一个回调函数。  
例如，创建一个玩家聊天事件的监听器：  
{% capture demo %} 
```javascript
function PlayerChatEvent(event){  
    let player = event.getPlayer();  
    let name = player.getName();  
    let msg = event.getMessage();  
    event.setMessage(name + " §7说：§r" + msg);  
}  
```  
---NEWTAB--- 
```python
def PlayerChatEvent(event):  
    player = event.getPlayer()  
    name = player.getName()  
    msg = event.getMessage()  
    event.setMessage(name + u" §7说：§r" + msg)  
```
---NEWTAB--- 
```lua
function PlayerChatEvent(event) 
    player = event:getPlayer() 
    name = player:getName()  
    msg = event:getMessage()  
    event:setMessage(name .. " §7说：§r" .. msg)
end  
```
---NEWTAB--- 
```php
function PlayerChatEvent($event){  
    $player = event->getPlayer();  
    $name = player->getName();  
    $msg = event->getMessage();  
    $event->setMessage(name . " §7说：§r" . msg);  
}  
```
{% endcapture %}
{% include tab.html tabId="demo" tabTitles="JavaScript,Python,Lua,PHP" tabContents=demo %}
 